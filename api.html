<!doctype html>
<html class="no-js" lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>API ∙ Universal Router</title>
    <meta name="description" content="Routing and navigation solution for React.js applications">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="https://www.kriasoft.com/universal-router/api">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700">
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
  <div class="header">
  <div class="container">
    <a class="header__logo" href=".">
      Universal <img class="header__logo-img" src="img/tour.svg" alt="Universal Router" /> Router
    </a>
    <span class="header_author">
      made with &nbsp;♥&nbsp; by&nbsp; <a href="https://twitter.com/koistya" rel="author" title="Konstantin Tarkus on Twitter">@koistya</a>
    </span>

  </div>
</div>


  <div class="content">
    <div class="content-left">
      <a class="edit-btn" target="_blank" href="https://github.com/kriasoft/universal-router/edit/master/docs/api.md" title="Edit on GitHub">
        <svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" width="612" height="612" viewBox="0 0 612 612"><path d="M545.062 286.875c-15.854 0-28.688 12.852-28.688 28.688v239.062h-459v-459h239.062c15.854 0 28.688-12.852 28.688-28.688S312.292 38.25 296.438 38.25H38.25C17.136 38.25 0 55.367 0 76.5v497.25C0 594.883 17.136 612 38.25 612H535.5c21.114 0 38.25-17.117 38.25-38.25V315.562c0-15.835-12.833-28.687-28.688-28.687zM605.325 88.95L523.03 6.655C518.556 2.18 512.684 0 506.812 0s-11.743 2.18-16.218 6.675l-318.47 318.45v114.75h114.75l318.45-318.45c4.494-4.495 6.675-10.366 6.675-16.237 0-5.89-2.18-11.743-6.675-16.238zM267.75 382.5H229.5v-38.25L506.812 66.938l38.25 38.25L267.75 382.5z"/></svg>
      </a>
      <h1 id="universal-router-api">Universal Router API</h1>
<h2 id="const-router--new-universalrouterroutes-options"><code>const router = new UniversalRouter(routes, options)</code></h2>
<p>Creates an universal router instance which have a single
<a href="#routerresolve-pathname-context---promiseany"><code>router.resolve()</code></a> method.
<code>UniversalRouter</code> constructor expects a plain javascript object for the first <code>routes</code> argument
with any amount of params where only <code>path</code> is required, or array of such objects.
Second <code>options</code> argument is optional where you can pass the following:</p>
<ul>
<li><code>context</code> - an object with any data which you want to pass to <code>resolveRoute</code> function.<br>
See <a href="#context">Context</a> section below for details.</li>
<li><code>baseUrl</code> - the base URL of the app. By default is empty string <code>''</code>.<br>
If all the URLs in your app are relative to some other &quot;base&quot; URL, use this option.</li>
<li><code>resolveRoute</code> - function for any custom route handling logic.<br>
For example you can define this option to work with routes in declarative manner.<br>
By default the router calls the <code>action</code> method of matched route.</li>
<li><code>errorHandler</code> - function for global error handling. Called with a single
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error">Error</a>
argument every time the route is not found or threw an error which always contain
<a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">http status <code>code</code></a> and
<a href="#context">current <code>context</code></a> for your convenience.</li>
</ul>
<pre><code class="language-js">import UniversalRouter from 'universal-router'

const routes = {
  path: '/page',            // string or regexp or array of them, optional

  name: 'page',             // unique string, optional
  parent: null,             // route object or null, automatically filled by the router
  children: [],             // array of route objects or null, optional

  action(context, params) { // function, optional

    // action method should return anything except `null` or `undefined` to be resolved by router
    // otherwise router will throw `Page not found` error if all matched routes returned nothing
    return '&lt;h1&gt;The Page&lt;/h1&gt;'
  },
  // ...
}

const options = {
  context: { user: null },
  baseUrl: '/base',
  resolveRoute(context, params) {
    if (typeof context.route.action === 'function') {
      return context.route.action(context, params)
    }
    return undefined
  },
  errorHandler(error) {
    console.error(error)
    console.dir(error.context)
    return error.code === 404
      ? '&lt;h1&gt;Page Not Found&lt;/h1&gt;'
      : '&lt;h1&gt;Oops! Something went wrong&lt;/h1&gt;'
  }
}

const router = new UniversalRouter(routes, options)
</code></pre>
<h2 id="routerresolve-pathname-context---promiseany"><code>router.resolve({ pathname, ...context })</code> ⇒ <code>Promise&lt;any&gt;</code></h2>
<p>Traverses the list of routes in the order they are defined until it finds the first route that
matches provided URL path string and whose <code>action</code> function returns anything other than <code>null</code> or <code>undefined</code>.</p>
<pre><code class="language-js">const router = new UniversalRouter([
  {
    path: '/one',
    action: () =&gt; 'Page One',
  },
  {
    path: '/two',
    action: () =&gt; `Page Two`,
  },
])

router.resolve({ pathname: '/one' })
  .then(result =&gt; console.log(result))
  // =&gt; Page One
</code></pre>
<p>Where <code>action</code> is just a regular function that may, or may not, return any arbitrary data
— a string, a React component, anything!</p>
<h2 id="nested-routes">Nested Routes</h2>
<p>Each route may have an optional <code>children: [ ... ]</code> property containing the list of child routes:</p>
<pre><code class="language-js">const router = new UniversalRouter({
  path: '/admin',
  children: [
    {
      path: '',                        // www.example.com/admin
      action: () =&gt; 'Admin Page',
    },
    {
      path: '/users',
      children: [
        {
          path: '',                    // www.example.com/admin/users
          action: () =&gt; 'User List',
        },
        {
          path: '/:username',          // www.example.com/admin/users/john
          action: () =&gt; 'User Profile',
        },
      ],
    },
  ],
})

router.resolve({ pathname: '/admin/users/john' })
  .then(result =&gt; console.log(result))
  // =&gt; User Profile
</code></pre>
<h2 id="url-parameters">URL Parameters</h2>
<p><strong>Named route parameters</strong> are captured and added to <code>context.params</code>.</p>
<pre><code class="language-js">const router = new UniversalRouter({
  path: '/hello/:username',
  action: (context) =&gt; `Welcome, ${context.params.username}!`,
})

router.resolve({ pathname: '/hello/john' })
  .then(result =&gt; console.log(result))
  // =&gt; Welcome, john!
</code></pre>
<p>Alternatively, captured parameters can be accessed via the second argument to an action method like so:</p>
<pre><code class="language-js">const router = new UniversalRouter({
  path: '/hello/:username',
  action: (ctx, { username }) =&gt; `Welcome, ${username}!`,
})

router.resolve({ pathname: '/hello/john' })
  .then(result =&gt; console.log(result))
  // =&gt; Welcome, john!
</code></pre>
<p>Router preserves the <code>context.params</code> values from the parent router.
If the parent and the child have conflicting param names, the child's value take precedence.</p>
<p>This functionality is powered by <a href="https://github.com/pillarjs/path-to-regexp">path-to-regexp</a> npm module
and works the same way as the routing solutions in many popular JavaScript frameworks such as Express and Koa.
Also check out online <a href="http://forbeslindesay.github.io/express-route-tester/">router tester</a>.</p>
<h2 id="context">Context</h2>
<p>In addition to a URL path string, any arbitrary data can be passed to the <code>router.resolve()</code> method,
that becomes available inside <code>action</code> functions.</p>
<pre><code class="language-js">const router = new UniversalRouter({
  path: '/hello',
  action(context) {
    return `Welcome, ${context.user}!`
  },
})

router.resolve({ pathname: '/hello', user: 'admin' })
  .then(result =&gt; console.log(result))
  // =&gt; Welcome, admin!
</code></pre>
<p>Router supports <code>context</code> option in the <code>UniversalRouter</code> constructor
to support for specify of custom context properties only once.</p>
<pre><code class="language-js">const context = {
  store: {},
  user: 'admin',
  // ...
}

const router = new UniversalRouter(route, { context })
</code></pre>
<p>Router always adds following parameters to the <code>context</code> object
before passing it to the <code>resolveRoute</code> function:</p>
<ul>
<li><code>router</code> - Current router instance.</li>
<li><code>route</code> - Matched route object.</li>
<li><code>next</code> - Middleware style function which can continue resolving,
see <a href="#middlewares">Middlewares</a> section below for details.</li>
<li><code>pathname</code> - URL which was transmitted to <code>router.resolve()</code>.</li>
<li><code>baseUrl</code> - Base URL path relative to the path of the current route.</li>
<li><code>path</code> - Matched path.</li>
<li><code>params</code> - Matched path params,
see <a href="#url-parameters">URL Parameters</a> section above for details.</li>
<li><code>keys</code> - An array of keys found in the path,
see <a href="https://github.com/pillarjs/path-to-regexp">path-to-regexp</a> documentation for details.</li>
</ul>
<h2 id="async-routes">Async Routes</h2>
<p>The router works great with asynchronous functions out of the box!</p>
<pre><code class="language-js">const router = new UniversalRouter({
  path: '/hello/:username',
  async action({ params }) {
    const resp = await fetch(`/api/users/${params.username}`)
    const user = await resp.json()
    if (user) return `Welcome, ${user.displayName}!`
  },
})

router.resolve({ pathname: '/hello/john' })
  .then(result =&gt; console.log(result))
  // =&gt; Welcome, John Brown!
</code></pre>
<p>Use <a href="http://babeljs.io/">Babel</a> to transpile your code with <code>async</code> / <code>await</code> to normal JavaScript.
Alternatively, stick to ES6 Promises:</p>
<pre><code class="language-js">const route = {
  path: '/hello/:username',
  action({ params }) {
    return fetch(`/api/users/${params.username}`)
      .then(resp =&gt; resp.json())
      .then(user =&gt; user &amp;&amp; `Welcome, ${user.displayName}!`)
  },
}
</code></pre>
<h2 id="middlewares">Middlewares</h2>
<p>Any route action function may act as a <strong>middleware</strong> by calling <code>context.next()</code>.</p>
<pre><code class="language-js">const router = new UniversalRouter({
  path: '', // optional
  async action({ next }) {
    console.log('middleware: start')
    const child = await next()
    console.log('middleware: end')
    return child
  },
  children: [
    {
      path: '/hello',
      action() {
        console.log('route: return a result')
        return 'Hello, world!'
      },
    },
  ],
})

router.resolve({ pathname: '/hello' })
// Prints:
//   middleware: start
//   route: return a result
//   middleware: end
</code></pre>
<p>Remember that <code>context.next()</code> iterates only child routes,
use <code>context.next(true)</code> to iterate through the all remaining routes.</p>
<p>Note that if the middleware action returns <code>null</code> then the router will skip all nested routes
and go to the next sibling route. But if the <code>action</code> is missing or returns <code>undefined</code>
then the router will try to match the child routes. This can be useful for permissions check.</p>
<pre><code class="language-js">const middlewareRoute = {
  path: '/admin',
  action(context) {
    if (!context.user) {
      return null // route does not match (skip all /admin* routes)
    }
    if (context.user.role !== 'Admin') {
      return 'Access denied!' // return a page (for any /admin* urls)
    }
    return undefined // or `return context.next()` - try to match child routes
  },
  children: [/* admin routes here */],
}
</code></pre>
<h2 id="url-generation">URL Generation</h2>
<p>In most web applications it's much simpler to just use a string for hyperlinks.</p>
<pre><code class="language-js">`&lt;a href=&quot;/page&quot;&gt;Page&lt;/a&gt;`
`&lt;a href=&quot;/user/${username}&quot;&gt;Profile&lt;/a&gt;`
`&lt;a href=&quot;/search?q=${query}&quot;&gt;Search&lt;/a&gt;`
`&lt;a href=&quot;/faq#question&quot;&gt;Question&lt;/a&gt;`
// etc.
</code></pre>
<p>However for some types of web applications it may be useful to generate URLs dynamically based on route name.
That's why this feature is available as an add-on with simple API <code>generateUrls(router, options) ⇒ Function</code>
where returned function is used for generating urls <code>url(routeName, params) ⇒ String</code>.</p>
<pre><code class="language-js">import UniversalRouter from 'universal-router'
import generateUrls from 'universal-router/generateUrls'

const routes = [
  { name: 'users', path: '/users' },
  { name: 'user', path: '/user/:username' },
]

const router = new UniversalRouter(routes, { baseUrl: '/base' })
const url = generateUrls(router)

url('users')                          // =&gt; '/base/users'
url('user', { username: 'john' })     // =&gt; '/base/user/john'
</code></pre>
<p>This approach also works fine for dynamically added routes at runtime.</p>
<pre><code class="language-js">routes.children.push({ path: '/world', name: 'hello' })

url('hello')                          // =&gt; '/base/world'
</code></pre>
<p>Use <code>encode</code> option for custom encoding of URI path segments. By default
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent">encodeURIComponent</a>
is used.</p>
<pre><code class="language-js">const prettyUrl = generateUrls(router, { encode: (value, token) =&gt; value })

url('user', { username: ':/' })       // =&gt; '/base/user/%3A%2F'
prettyUrl('user', { username: ':/' }) // =&gt; '/base/user/:/'
</code></pre>
<p>Provide a function to <code>stringifyQueryParams</code> option to generate URL with
<a href="http://en.wikipedia.org/wiki/Query_string">query string</a> from unknown route params.</p>
<pre><code class="language-js">const urlWithQueryString = generateUrls(router, {
  stringifyQueryParams(params) {
    return Object.keys(params).map(key =&gt; `${key}=${params[key]}`).join('&amp;')
  },
})

const params = { username: 'John', busy: 1 }
url('user', params)                   // =&gt; /base/user/John
urlWithQueryString('user', params)    // =&gt; /base/user/John?busy=1
</code></pre>
<p>Or use external library such as <a href="https://github.com/ljharb/qs">qs</a>,
<a href="https://github.com/sindresorhus/query-string">query-string</a>, etc.</p>
<pre><code class="language-js">import qs from 'qs'
generateUrls(router, { stringifyQueryParams: qs.stringify })
</code></pre>
<h2>Recipes</h2>
<ul>
<li><a href="redirects">Redirects</a></li>
<li><a href="https://github.com/kriasoft/universal-router/issues/new">Request a recipe</a></li>
</ul>


      <div id="disqus_thread"></div>

    </div>
  </div>
  <div class="footer">
  <div class="container clearfix">
    <p class="footer__left">Licensed under the <a href="https://github.com/kriasoft/universal-router/blob/master/LICENSE.txt">MIT license</a></p>
    <p class="footer__right">&copy; 2015-<script>document.write(new Date().getFullYear())</script> <a href="https://www.kriasoft.com">Kriasoft</a></p>
  </div>
</div>

  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-33821884-1','auto');ga('send','pageview');

    window.disqus_shortname = 'kriasoft';
    window.disqus_identifier = 'universal-router/api';
    window.disqus_title = 'API ∙ Universal Router';
    window.disqus_url = 'https://www.kriasoft.com/universal-router/api';

  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

  <script src="https://kriasoft.disqus.com/embed.js" async defer></script>

  </body>
</html>

